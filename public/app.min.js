!function(){angular.module("app",["ngRoute","ngStorage","users","news","ngTagsInput"]),angular.module("users",["ngStorage"]),angular.module("news",["ngStorage"])}(),function(){function e(e){e.when("/",{controller:"appController",controllerAs:"appCtrl",templateUrl:"templates/welcome.html"}).when("/news",{controller:"appController",controllerAs:"appCtrl",templateUrl:"templates/news/news.html"}).otherwise({redirectTo:"/"})}function t(e,t,r){e.$on("$routeChangeStart",function(e,n,o){"/"!==t.path()&&""!==t.path()&&void 0===r.currentUser&&(t.path("/"),swal({title:"You must log in to do this.",type:"error",timer:3500}))})}angular.module("app").config(e),e.$inject=["$routeProvider"],angular.module("app").run(t),t.$inject=["$rootScope","$location","$sessionStorage"]}(),function(){"use strict";function e(e){this.loggedIn=function(){return e.loggedIn()},this.currentUser=function(){return e.currentUser()}}angular.module("app").controller("appController",e),e.$inject=["sessionService"]}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"templates/shared/navbar.html",controller:t,controllerAs:"navbarCtrl"};return e}function t(e,t,r){function n(){$("#search-modal").modal("hide"),e.$emit("newsChanged")}var o=this;o.session={},o.login=function(){t.login(o.session).then(o.session={})},o.logout=function(){t.logout()},o.clearSearch=function(){r.clearCurrentNews(),o.filters={},n()},o.searchByQuery=function(){r.setCurrentFilter(o.filters),n()},e.$on("login",function(){o.tagCollection=r.getTags(),o.providerCollection=r.getProviders(),o.categoryCollection=r.getCategories(),o.peopleCollection=r.getPeople(),o.locationCollection=r.getLocations()}),e.$on("logout",function(){o.logout()})}angular.module("app").directive("appNavbar",e),t.$inject=["$rootScope","sessionService","searchService"]}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"/templates/news/newsDisplay.html",controller:t,controllerAs:"newsDisplayCtrl"};return e}function t(e,t){var r=this;r.currentPage=e.getCurrentPage(),r.updateNews=function(t){var n=e.getCurrentFilter();n?r.newsItems=e.getNews(t,n):r.newsItems=e.getNews(t),r.newsItems.then(function(){r.newsItems=e.getCurrentNews(),r.currentPage=e.getCurrentPage()})},r.updateNews(r.currentPage),t.$on("newsChanged",function(){r.updateNews()}),r.scrollUp=function(){$(".scroll-to-top").on("click",function(){$("html, body").animate({scrollTop:0},800)})}}angular.module("news").directive("newsDisplay",e),t.$inject=["searchService","$rootScope"]}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"/templates/shared/userSignup.html",controller:t,controllerAs:"signupCtrl"};return e}function t(e){var t=this;t.userForm={},t.submit=function(){e.signup(t.userForm),t.userForm={}}}angular.module("users").directive("userSignup",e),t.$inject=["signupService"]}(),function(){"use strict";function e(e,t,r,n,o){function i(t,n){return e({method:"get",url:t,params:n,headers:{Authorization:"Bearer "+r.currentUser.token}}).error(function(){o.$emit("logout"),swal({title:"Error. Please login again.",type:"error"})})}var s=this;s.newsPath="http://arqui8.ing.puc.cl/api/v1/private/news",s.searchPath="http://arqui8.ing.puc.cl/api/v1/private/search",s.tagsPath="http://arqui8.ing.puc.cl/api/v1/private/tags",s.providersPath="http://arqui8.ing.puc.cl/api/v1/private/news_providers",s.categoriesPath="http://arqui8.ing.puc.cl/api/v1/private/categories",s.peoplePath="http://arqui8.ing.puc.cl/api/v1/private/people",s.locationsPath="http://arqui8.ing.puc.cl/api/v1/private/locations",n.currentPage=0,s.getCurrentNews=function(){return n.currentNews},s.getCurrentPage=function(){return n.currentPage},s.setCurrentNewsAndPage=function(e,t){n.currentNews=e,n.currentPage=t},s.clearCurrentNews=function(){delete n.currentNews,delete n.currentPage,delete n.currentFilter},s.getCurrentFilter=function(){return n.currentFilter},s.setCurrentFilter=function(e){function t(e){return e.text}delete n.currentPage,delete n.currentFilter;var r={};e.tags&&(r.tags=e.tags.map(t)),e.providers&&(r.providers=e.providers.map(t)),e.categories&&(r.categories=e.categories.map(t)),e.people&&(r.people=e.people.map(t)),e.locations&&(r.locations=e.locations.map(t)),n.currentFilter=r},s.getTags=function(){return i(s.tagsPath).success(function(e){n.tagList=_.uniq(e.tags.map(s.tagBuilder),JSON.stringify)}).then(function(){return n.tagList})},s.getProviders=function(){return i(s.providersPath).success(function(e){n.providerList=_.uniq(e.news_providers.map(s.tagBuilder),JSON.stringify)}).then(function(){return n.providerList})},s.getCategories=function(){return i(s.categoriesPath).success(function(e){n.categoryList=_.uniq(e.categories.map(s.tagBuilder),JSON.stringify)}).then(function(){return n.categoryList})},s.getPeople=function(){return i(s.peoplePath).success(function(e){n.peopleList=_.uniq(e.people.map(s.tagBuilder),JSON.stringify)}).then(function(){return n.peopleList})},s.getLocations=function(){return i(s.locationsPath).success(function(e){n.locationList=_.uniq(e.locations.map(s.tagBuilder),JSON.stringify)}).then(function(){return n.locationList})},s.tagBuilder=function(e){return{text:e.name}},s.getNews=function(e,t){var r={};return t&&(r=t),r.page=e,i(s.newsPath,r).success(function(t){s.setCurrentNewsAndPage(t.news,e)})}}angular.module("news").service("searchService",e),e.$inject=["$http","$window","$sessionStorage","$localStorage","$rootScope"]}(),function(){"use strict";function e(e,t,r,n,o){var i=this;i.login=function(n){return e({method:"POST",url:"http://arqui8.ing.puc.cl/api/v1/auth/token",data:$.param(n),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){r.currentUser={username:n.username,token:e.token},o.$emit("login"),t.location.href="/#/news"}).error(function(){swal({title:"Error signing in.",type:"error"}),t.location.href="/#/"})},i.logout=function(){r.$reset(),n.$reset(),t.location.href="/#/"},i.loggedIn=function(){return void 0!==r.currentUser},i.currentUser=function(){return r.currentUser}}angular.module("app").service("sessionService",e),e.$inject=["$http","$window","$sessionStorage","$localStorage","$rootScope"]}(),function(){"use strict";function e(e,t,r,n){this.signup=function(o){o.password===o.passwordConfirmation?e({method:"POST",url:"http://arqui8.ing.puc.cl/api/v1/auth/signup",data:$.param(o),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){$("#signup-modal").modal("hide"),r.currentUser={username:o.username,password:o.password,token:e.token},n.$emit("login"),t.location.href="/#/news"}).error(function(e){swal({title:"Error creating your account.",type:"error"}),t.location.href="/#/"}):swal({title:"Your password and its confirmation must be the same.",type:"error"})}}angular.module("users").service("signupService",e),e.$inject=["$http","$window","$sessionStorage","$rootScope"]}(),$(document).ready(function(){$(window).scroll(function(){$(this).scrollTop()>100?$(".scroll-to-top").show():$(".scroll-to-top").hide()})});