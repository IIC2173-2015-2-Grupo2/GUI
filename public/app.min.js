!function(){angular.module("app",["ngRoute","ngStorage","users","news","ngTagsInput"]),angular.module("users",["ngStorage"]),angular.module("news",["ngStorage"])}(),function(){function e(e){e.when("/",{controller:"appController",controllerAs:"appCtrl",templateUrl:"templates/welcome.html"}).when("/news",{controller:"appController",controllerAs:"appCtrl",templateUrl:"templates/news/news.html"}).otherwise({redirectTo:"/"})}function t(e,t,n){e.$on("$routeChangeStart",function(e,r,o){"/"!==t.path()&&""!==t.path()&&void 0===n.currentUser&&(t.path("/"),swal({title:"You must log in to do this.",type:"error",timer:3500}))})}angular.module("app").config(e),e.$inject=["$routeProvider"],angular.module("app").run(t),t.$inject=["$rootScope","$location","$sessionStorage"]}(),function(){"use strict";function e(e){this.loggedIn=function(){return e.loggedIn()},this.currentUser=function(){return e.currentUser()}}angular.module("app").controller("appController",e),e.$inject=["sessionService"]}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"templates/shared/navbar.html",controller:t,controllerAs:"navbarCtrl"};return e}function t(e,t,n){function r(){$("#search-modal").modal("hide"),e.$emit("newsChanged")}function o(){t.loggedIn()&&(i.tagCollection=i.tagCollection||n.getLSTags(),i.providerCollection=i.providerCollection||n.getLSProviders(),i.categoryCollection=i.categoryCollection||n.getLSCategories(),i.peopleCollection=i.peopleCollection||n.getLSPeople(),i.locationCollection=i.locationCollection||n.getLSLocations(),i.companyCollection=i.companyCollection||n.getLSCompanies())}var i=this;i.session={},o(),i.login=function(){t.login(i.session).then(i.session={})},i.logout=function(){t.logout()},i.clearSearch=function(){n.clearCurrentNews(),i.filters={},r()},i.search=function(){n.setCurrentFilter(i.filters),r()},e.$on("login",function(){i.tagCollection=n.getTags(),i.providerCollection=n.getProviders(),i.categoryCollection=n.getCategories(),i.peopleCollection=n.getPeople(),i.locationCollection=n.getLocations(),i.companyCollection=n.getCompanies()}),e.$on("logout",function(){i.logout()})}angular.module("app").directive("appNavbar",e),t.$inject=["$rootScope","sessionService","searchService"]}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"/templates/news/newsDisplay.html",controller:t,controllerAs:"newsDisplayCtrl"};return e}function t(e,t){var n=this;n.currentPage=e.getCurrentPage(),n.updateNews=function(t){var r=e.getCurrentFilter();e.getNews(t,r).then(function(){n.newsItems=e.getCurrentNews(),n.newsItems.forEach(function(e){e.clicked=!1}),n.currentPage=e.getCurrentPage()})},n.updateNews(n.currentPage),t.$on("newsChanged",function(){n.updateNews(0)}),n.scrollUp=function(){$(".scroll-to-top").on("click",function(){$("html, body").animate({scrollTop:0},800)})}}angular.module("news").directive("newsDisplay",e),t.$inject=["searchService","$rootScope"]}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"/templates/shared/userSignup.html",controller:t,controllerAs:"signupCtrl"};return e}function t(e){var t=this;t.userForm={},t.submit=function(){e.signup(t.userForm),t.userForm={}}}angular.module("users").directive("userSignup",e),t.$inject=["signupService"]}(),function(){"use strict";function e(e,t,n,r,o){function i(t,r){return e({method:"get",url:t,params:r,headers:{Authorization:"Bearer "+n.currentUser.token}}).error(function(){o.$emit("logout"),swal({title:"Error. Please login again.",type:"error"})})}var a=this;a.newsPath="http://arqui8.ing.puc.cl/api/v1/private/news",a.searchPath="http://arqui8.ing.puc.cl/api/v1/private/search",a.tagsPath="http://arqui8.ing.puc.cl/api/v1/private/tags",a.providersPath="http://arqui8.ing.puc.cl/api/v1/private/news_providers",a.categoriesPath="http://arqui8.ing.puc.cl/api/v1/private/categories",a.peoplePath="http://arqui8.ing.puc.cl/api/v1/private/people",a.locationsPath="http://arqui8.ing.puc.cl/api/v1/private/locations",a.companiesPath="http://arqui8.ing.puc.cl/api/v1/private/companies",a.getCurrentNews=function(){return r.currentNews},a.getCurrentPage=function(){return r.currentPage||0},a.setCurrentNewsAndPage=function(e,t){r.currentNews=e,r.currentPage=t},a.clearCurrentNews=function(){delete r.currentNews,delete r.currentPage,delete r.currentFilter},a.getCurrentFilter=function(){return r.currentFilter},a.setCurrentFilter=function(e){function t(e){return e.text}delete r.currentPage,delete r.currentFilter;var n={};e.tags&&(n.tags=e.tags.map(t)),e.providers&&(n.providers=e.providers.map(t)),e.categories&&(n.categories=e.categories.map(t)),e.people&&(n.people=e.people.map(t)),e.locations&&(n.locations=e.locations.map(t)),e.companies&&(n.companies=e.companies.map(t)),r.currentFilter=n},a.getLSTags=function(){return r.tagList},a.getLSProviders=function(){return r.providerList},a.getLSCategories=function(){return r.categoryList},a.getLSPeople=function(){return r.peopleList},a.getLSLocations=function(){return r.locationList},a.getLSCompanies=function(){return r.companyList},a.getTags=function(){return i(a.tagsPath).success(function(e){r.tagList=_.uniq(e.tags.map(a.tagBuilder),JSON.stringify)}).then(function(){return a.getLSTags()})},a.getProviders=function(){return i(a.providersPath).success(function(e){r.providerList=_.uniq(e.news_providers.map(a.tagBuilder),JSON.stringify)}).then(function(){return a.getLSProviders()})},a.getCategories=function(){return i(a.categoriesPath).success(function(e){r.categoryList=_.uniq(e.categories.map(a.tagBuilder),JSON.stringify)}).then(function(){return a.getLSCategories()})},a.getPeople=function(){return i(a.peoplePath).success(function(e){r.peopleList=_.uniq(e.people.map(a.tagBuilder),JSON.stringify)}).then(function(){return a.getLSPeople()})},a.getLocations=function(){return i(a.locationsPath).success(function(e){r.locationList=_.uniq(e.locations.map(a.tagBuilder),JSON.stringify)}).then(function(){return a.getLSLocations()})},a.getCompanies=function(){return i(a.companiesPath).success(function(e){r.companyList=_.uniq(e.companies.map(a.tagBuilder),JSON.stringify)}).then(function(){return a.getLSCompanies()})},a.tagBuilder=function(e){return{text:e.name}},a.getNews=function(e,t){var n=a.newsPath,r={};return t&&(n=a.searchPath,r=t),r.page=e,i(n,r).success(function(t){a.setCurrentNewsAndPage(t.news,e)})}}angular.module("news").service("searchService",e),e.$inject=["$http","$window","$sessionStorage","$localStorage","$rootScope"]}(),function(){"use strict";function e(e,t,n,r,o){var i=this;i.login=function(r){return e({method:"POST",url:"http://arqui8.ing.puc.cl/api/v1/auth/token",data:$.param(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){n.currentUser={username:r.username,token:e.token},o.$emit("login"),t.location.href="/#/news"}).error(function(){swal({title:"Error signing in.",type:"error"}),t.location.href="/#/"})},i.logout=function(){n.$reset(),r.$reset(),t.location.href="/#/"},i.loggedIn=function(){return void 0!==n.currentUser},i.currentUser=function(){return n.currentUser}}angular.module("app").service("sessionService",e),e.$inject=["$http","$window","$sessionStorage","$localStorage","$rootScope"]}(),function(){"use strict";function e(e,t,n,r){this.signup=function(o){o.password===o.passwordConfirmation?e({method:"POST",url:"http://arqui8.ing.puc.cl/api/v1/auth/signup",data:$.param(o),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){$("#signup-modal").modal("hide"),n.currentUser={username:o.username,password:o.password,token:e.token},r.$emit("login"),t.location.href="/#/news"}).error(function(e){swal({title:"Error creating your account.",type:"error"}),t.location.href="/#/"}):swal({title:"Your password and its confirmation must be the same.",type:"error"})}}angular.module("users").service("signupService",e),e.$inject=["$http","$window","$sessionStorage","$rootScope"]}(),$(document).ready(function(){$(window).scroll(function(){$(this).scrollTop()>100?$(".scroll-to-top").show():$(".scroll-to-top").hide()})});