!function(){angular.module("app",["ngRoute","ngStorage","users","news","ngTagsInput"]),angular.module("users",["ngStorage"]),angular.module("news",["ngStorage"])}(),function(){function e(e){e.when("/",{controller:"appController",controllerAs:"appCtrl",templateUrl:"templates/welcome.html"}).when("/news",{controller:"appController",controllerAs:"appCtrl",templateUrl:"templates/news/news.html"}).otherwise({redirectTo:"/"})}function t(e,t,n){e.$on("$routeChangeStart",function(e,r,o){"/"!==t.path()&&""!==t.path()&&void 0===n.currentUser&&(t.path("/"),swal({title:"You must log in to do this.",type:"error",timer:3500}))})}angular.module("app").config(e),e.$inject=["$routeProvider"],angular.module("app").run(t),t.$inject=["$rootScope","$location","$sessionStorage"]}(),function(){"use strict";function e(e){this.loggedIn=function(){return e.loggedIn()},this.currentUser=function(){return e.currentUser()}}angular.module("app").controller("appController",e),e.$inject=["sessionService"]}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"templates/shared/navbar.html",controller:t,controllerAs:"navbarCtrl"};return e}function t(e,t,n){function r(){$("#search-modal").modal("hide"),e.$emit("newsChanged")}var o=this;o.session={},o.login=function(){t.login(o.session).then(o.session={})},o.logout=function(){t.logout()},o.clearSearch=function(){n.clearCurrentNews(),o.filters={},r()},o.search=function(){n.setCurrentFilter(o.filters),r()},e.$on("login",function(){o.tagCollection=n.getTags(),o.providerCollection=n.getProviders(),o.categoryCollection=n.getCategories(),o.peopleCollection=n.getPeople(),o.locationCollection=n.getLocations(),o.companyCollection=n.getCompanies()}),e.$on("logout",function(){o.logout()})}angular.module("app").directive("appNavbar",e),t.$inject=["$rootScope","sessionService","searchService"]}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"/templates/news/newsDisplay.html",controller:t,controllerAs:"newsDisplayCtrl"};return e}function t(e,t){var n=this;n.currentPage=e.getCurrentPage(),n.updateNews=function(t){var r=e.getCurrentFilter();r?n.newsItems=e.getNews(t,r):n.newsItems=e.getNews(t),n.newsItems.then(function(){n.newsItems=e.getCurrentNews(),n.newsItems.forEach(function(e){e.clicked=!1}),n.currentPage=e.getCurrentPage()})},n.updateNews(n.currentPage),t.$on("newsChanged",function(){n.updateNews(0)}),n.scrollUp=function(){$(".scroll-to-top").on("click",function(){$("html, body").animate({scrollTop:0},800)})}}angular.module("news").directive("newsDisplay",e),t.$inject=["searchService","$rootScope"]}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"/templates/shared/userSignup.html",controller:t,controllerAs:"signupCtrl"};return e}function t(e){var t=this;t.userForm={},t.submit=function(){e.signup(t.userForm),t.userForm={}}}angular.module("users").directive("userSignup",e),t.$inject=["signupService"]}(),function(){"use strict";function e(e,t,n,r,o){function i(t,r){return e({method:"get",url:t,params:r,headers:{Authorization:"Bearer "+n.currentUser.token}}).error(function(){o.$emit("logout"),swal({title:"Error. Please login again.",type:"error"})})}var s=this;s.newsPath="http://arqui8.ing.puc.cl/api/v1/private/news",s.searchPath="http://arqui8.ing.puc.cl/api/v1/private/search",s.tagsPath="http://arqui8.ing.puc.cl/api/v1/private/tags",s.providersPath="http://arqui8.ing.puc.cl/api/v1/private/news_providers",s.categoriesPath="http://arqui8.ing.puc.cl/api/v1/private/categories",s.peoplePath="http://arqui8.ing.puc.cl/api/v1/private/people",s.locationsPath="http://arqui8.ing.puc.cl/api/v1/private/locations",s.companiesPath="http://arqui8.ing.puc.cl/api/v1/private/companies",s.getCurrentNews=function(){return r.currentNews},s.getCurrentPage=function(){return r.currentPage||0},s.setCurrentNewsAndPage=function(e,t){r.currentNews=e,r.currentPage=t},s.clearCurrentNews=function(){delete r.currentNews,delete r.currentPage,delete r.currentFilter},s.getCurrentFilter=function(){return r.currentFilter},s.setCurrentFilter=function(e){function t(e){return e.text}delete r.currentPage,delete r.currentFilter;var n={};e.tags&&(n.tags=e.tags.map(t)),e.providers&&(n.providers=e.providers.map(t)),e.categories&&(n.categories=e.categories.map(t)),e.people&&(n.people=e.people.map(t)),e.locations&&(n.locations=e.locations.map(t)),e.companies&&(n.companies=e.companies.map(t)),r.currentFilter=n},s.getTags=function(){return i(s.tagsPath).success(function(e){r.tagList=_.uniq(e.tags.map(s.tagBuilder),JSON.stringify)}).then(function(){return r.tagList})},s.getProviders=function(){return i(s.providersPath).success(function(e){r.providerList=_.uniq(e.news_providers.map(s.tagBuilder),JSON.stringify)}).then(function(){return r.providerList})},s.getCategories=function(){return i(s.categoriesPath).success(function(e){r.categoryList=_.uniq(e.categories.map(s.tagBuilder),JSON.stringify)}).then(function(){return r.categoryList})},s.getPeople=function(){return i(s.peoplePath).success(function(e){r.peopleList=_.uniq(e.people.map(s.tagBuilder),JSON.stringify)}).then(function(){return r.peopleList})},s.getLocations=function(){return i(s.locationsPath).success(function(e){r.locationList=_.uniq(e.locations.map(s.tagBuilder),JSON.stringify)}).then(function(){return r.locationList})},s.getCompanies=function(){return i(s.companiesPath).success(function(e){r.companyList=_.uniq(e.companies.map(s.tagBuilder),JSON.stringify)}).then(function(){return r.companyList})},s.tagBuilder=function(e){return{text:e.name}},s.getNews=function(e,t){var n=s.newsPath,r={};return t&&(n=s.searchPath,r=t),r.page=e,i(n,r).success(function(t){s.setCurrentNewsAndPage(t.news,e)})}}angular.module("news").service("searchService",e),e.$inject=["$http","$window","$sessionStorage","$localStorage","$rootScope"]}(),function(){"use strict";function e(e,t,n,r,o){var i=this;i.login=function(r){return e({method:"POST",url:"http://arqui8.ing.puc.cl/api/v1/auth/token",data:$.param(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){n.currentUser={username:r.username,token:e.token},o.$emit("login"),t.location.href="/#/news"}).error(function(){swal({title:"Error signing in.",type:"error"}),t.location.href="/#/"})},i.logout=function(){n.$reset(),r.$reset(),t.location.href="/#/"},i.loggedIn=function(){return void 0!==n.currentUser},i.currentUser=function(){return n.currentUser}}angular.module("app").service("sessionService",e),e.$inject=["$http","$window","$sessionStorage","$localStorage","$rootScope"]}(),function(){"use strict";function e(e,t,n,r){this.signup=function(o){o.password===o.passwordConfirmation?e({method:"POST",url:"http://arqui8.ing.puc.cl/api/v1/auth/signup",data:$.param(o),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){$("#signup-modal").modal("hide"),n.currentUser={username:o.username,password:o.password,token:e.token},r.$emit("login"),t.location.href="/#/news"}).error(function(e){swal({title:"Error creating your account.",type:"error"}),t.location.href="/#/"}):swal({title:"Your password and its confirmation must be the same.",type:"error"})}}angular.module("users").service("signupService",e),e.$inject=["$http","$window","$sessionStorage","$rootScope"]}(),$(document).ready(function(){$(window).scroll(function(){$(this).scrollTop()>100?$(".scroll-to-top").show():$(".scroll-to-top").hide()})});